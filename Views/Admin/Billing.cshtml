@model LinkCare_IT15.Models.AdminModel.AdminBillingModel

@{
    ViewBag.Title = "Billing · Link Care";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="mb-3">
        <h3 class="fw-bold">Billing & Payments</h3>
        <p class="text-muted">Manage patient bills and payment records</p>
    </div>

    <div class="lc-card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
                <i class="bi bi-receipt me-2"></i> Bill Management
            </h5>
            <a asp-action="CreateBill" class="btn btn-primary btn-sm">+ Create Bill</a>
        </div>

        <!-- Summary -->
        <div class="row text-center mb-4">
            <div class="col-md-3">
                <div class="lc-card p-3 shadow-sm">
                    <h6 class="fw-bold">Total Revenue</h6>
                    <p class="text-success fs-5 fw-bold">₱@Model.TotalRevenue</p>
                    <small class="text-muted">All paid bills</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="lc-card p-3 shadow-sm">
                    <h6 class="fw-bold">Pending</h6>
                    <p class="text-warning fs-5 fw-bold">₱@Model.Pending</p>
                    <small class="text-muted">Awaiting payment</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="lc-card p-3 shadow-sm">
                    <h6 class="fw-bold">Overdue</h6>
                    <p class="text-danger fs-5 fw-bold">₱@Model.Overdue</p>
                    <small class="text-muted">Past due bills</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="lc-card p-3 shadow-sm">
                    <h6 class="fw-bold">Total Bills</h6>
                    <p class="fs-5 fw-bold">@Model.TotalBills</p>
                    <small class="text-muted">All time</small>
                </div>
            </div>
        </div>

        <!-- Bills Table -->
        <div>
            <h6 class="fw-bold mb-2">Bill Records</h6>
            <p class="small text-muted">@Model.Bills.Count records</p>

            <div class="list-group">
                @foreach (var bill in Model.Bills.OrderByDescending(b => b.Date))
                {
                    var badgeClass = bill.Status.ToLower() switch
                    {
                        "paid" => "bg-success-subtle text-success",
                        "pending" => "bg-warning-subtle text-warning",
                        "overdue" => "bg-danger-subtle text-danger",
                        _ => "bg-secondary-subtle text-secondary"
                    };

                    <div class="list-group-item d-flex justify-content-between align-items-center mb-2 rounded shadow-sm">
                        <div>
                            <div class="fw-semibold text-primary">
                                <i class="bi bi-person me-1"></i> @bill.PatientName
                            </div>
                            <div>
                                <small class="text-muted">@bill.Date.ToString("MMM dd, yyyy")</small> ·
                                <span>@bill.Services</span>
                            </div>
                            <div class="fw-bold">₱@bill.Amount</div>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge rounded-pill @badgeClass text-capitalize">
                                @bill.Status
                            </span>
                            @if (bill.Status.ToLower() == "pending")
                            {
                                <a asp-action="MarkPaid" asp-route-id="@bill.Id" class="btn btn-sm btn-outline-success">Mark Paid</a>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
