@{
    ViewData["Title"] = "Reports & Analytics";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid py-4">
    <h2 class="fw-bold mb-1">Reports & Analytics</h2>
    <p class="text-muted">Clinic performance insights and data analysis</p>

    <!-- Report Selector -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <div class="mb-2">
            <select class="form-select w-auto d-inline" onchange="showReport(this.value)">
                <option value="overview">📊 Overview Report</option>
                <option value="revenue">💰 Revenue Analysis</option>
                <option value="patient">🧑‍⚕️ Patient Analytics</option>
            </select>
        </div>
        <button class="btn btn-primary">Export Report</button>
    </div>

    <!-- Overview Report -->
    <div id="overviewReport">
        <!-- Stat Cards -->
        <div class="row g-3 mb-4">
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-muted">Total Patients</h6>
                        <h4 class="fw-bold">6</h4>
                        <small class="text-success">Active patients</small>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-muted">Appointments</h6>
                        <h4 class="fw-bold">14</h4>
                        <small>This month</small>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-muted">Revenue</h6>
                        <h4 class="fw-bold text-success">$17,800</h4>
                        <small>This month</small>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-muted">Consultations</h6>
                        <h4 class="fw-bold">2</h4>
                        <small>Completed</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="row g-3">
            <div class="col-12 col-lg-6 d-flex">
                <div class="card shadow-sm flex-fill">
                    <div class="card-header fw-bold">Appointment Status Distribution</div>
                    <div class="card-body d-flex justify-content-center align-items-center">
                        <canvas id="appointmentChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6 d-flex">
                <div class="card shadow-sm flex-fill">
                    <div class="card-header fw-bold">Daily Patient Count</div>
                    <div class="card-body">
                        <canvas id="dailyPatientChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Report -->
    <div id="revenueReport" class="d-none">
        @Html.Partial("_RevenueReport")
    </div>

    <!-- Patient Report -->
    <div id="patientReport" class="d-none">
        @Html.Partial("_PatientReport")
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function showReport(type) {
        document.getElementById("overviewReport").classList.add("d-none");
        document.getElementById("revenueReport").classList.add("d-none");
        document.getElementById("patientReport").classList.add("d-none");

        if (type === "overview") document.getElementById("overviewReport").classList.remove("d-none");
        if (type === "revenue") document.getElementById("revenueReport").classList.remove("d-none");
        if (type === "patient") document.getElementById("patientReport").classList.remove("d-none");
    }

    // Pie Chart
    new Chart(document.getElementById("appointmentChart"), {
        type: 'pie',
        data: {
            labels: ["Completed", "Pending"],
            datasets: [{
                data: [11, 3],
                backgroundColor: ["#3b82f6", "#10b981"]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Bar Chart
    new Chart(document.getElementById("dailyPatientChart"), {
        type: 'bar',
        data: {
            labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            datasets: [{
                label: "Patients",
                data: [12, 15, 18, 14, 16, 9, 5],
                backgroundColor: "#3b82f6"
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
